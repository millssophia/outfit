<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Photo Viewer with Drag-and-Drop</title>
  <style>
    body {
      font-family: Georgia, serif;
      font-size: 14px; /* Slightly smaller base font */
      letter-spacing: 1.2px;
      background-color: #362200;
      color: #452c00;
      font-weight: 700;
      text-transform: uppercase;
      margin: 0; /* Remove default body margin */
      padding: 0; /* Remove default body padding */
    }

    .container {
	  margin: 10px auto; /* Add a little margin, also on the sides */
      text-align: center;
      background-color: #F8E9D0;
      padding: 20px; /* Smaller padding */
      border-radius: 20px; /* Less border radius */
      width: 95%; /* Slightly smaller width */
      max-width: 600px; /* Add a max width */
    }

    h1 {
      margin-bottom: 15px; /* Slightly smaller margin */
      color: #362200;
      font-size: 1.5em; /* Relative size for better scaling */
    }
    
    
    select {
      font-family: Impact, serif;
      font-size: 8px;
      color: #362200;
      background-color: #F8E9D0;
      text-transform: none;
      border: none;
    }

    select:hover {
      background-color: #362200;
      color: #F8E9D0;
      border-radius: 5px;
    }


	a:hover {
	  color: #FFFFFF; /* Change text color to white */
	  transform: scale(1.05); /* Add a slight zoom effect */
	}
	
	a:active {
	  transform: scale(0.95); /* Add a "pressed" effect */
	}
    .image-gallery {
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      margin-bottom: 15px; /* Smaller margin */
    }

    .image-gallery img {
      width: 70px; /* Smaller image size */
      height: 70px; /* Smaller image size */
      object-fit: cover;
      margin: 5px; /* Smaller margin */
      cursor: pointer;
      border-radius: 5px;
      transition: transform 0.3s ease;
    }

    .image-gallery img:hover {
      transform: scale(1.1);
    }

    #canvas {
	  margin: 10px auto; /* Keep margin, but make it smaller */
      position: relative;
      width: 90%; /* Smaller canvas */
      height: 300px; /* Smaller height */
      border: 2px dashed #FF9999;
      border-radius: 10px;
      overflow: hidden;
      background: transparent;      
      display: flex;
      justify-content: center;
      align-items: center;
    }

    #canvas p {
      color: #FF9999;
      font-size: 1em; /* Slightly smaller text */
    }

    .draggable {
      position: absolute;
      max-width: 100px; /* Smaller draggable image */
      max-height: 100px; /* Smaller draggable image */
      cursor: grab;
      user-select: none;
    }

    .draggable:active {
      cursor: grabbing;
    }

    /* Hide the gallery by default */
    .hidden {
      display: none;
    }

    button {
      background-color: #4f3100;
      text-transform: uppercase;
      border-radius: 5px;
      border: 1px solid #362200;
      display: inline-block;
      cursor: pointer;
      color: #ffffff;
      font-family: Impact;
      font-size: 8px; /* Smaller button text */
      padding: 4px 2px; /* Smaller button padding */
      text-decoration: none;
      margin: 5px; /* Smaller button margin */
    }
    
    button:hover {
    background-color: #7e4400;
    }
    
    button:active {
    padding: 3px 1px; /* Smaller active state padding */
    }

    #showTopsButton, #showBottomsButton, #showOtherButton {
      display: inline-block;
      cursor: pointer;
      text-transform: capitalize;
      color: #ffffff;
      font-family: Georgia;
      font-size: 15px; /* Smaller text size */
      font-weight: bold;
      padding: 8px 20px; /* Smaller padding */
      text-decoration: none;
      text-shadow: 2px 2px 0px #528ecc; /* Slightly smaller text shadow */
      margin: 5px; /* Smaller margin */
      margin-bottom: 5px;
      background-color: #FFCCCB;
      text-shadow: 2px 2px 0px #FF9999; /* Slightly smaller text shadow */
      box-shadow: 3px 3px 0px 0px #FF9999; /* Slightly smaller box shadow */
      border: 1px solid #FF9999;
      border-radius: 0px;
    }
    
    #showTopsButton:hover, #showBottomsButton:hover, #showOtherButton:hover {
    	border: none;
    }
    
    #showTopsButton:active, #showBottomsButton:active, #showOtherButton:active {
	  background-color: #FFCCCB;
	  box-shadow: 1px 1px #FF9999;
	  transform: translateY(1px);
	  transform: translateX(1px);
    }

	/* Responsive adjustments */
	@media (max-width: 600px) {
	  .container {
	    padding: 15px;
		width: 98%; /* Take a bit more of the screen on small devices */
	  }
	
	  h1 {
	    font-size: 1.3em;
	  }
	
	  .image-gallery img {
	    width: 50px; /* Even smaller on small screens */
	    height: 50px; /* Even smaller on small screens */
	  }
	
	  #canvas {
	    height: 250px; /* Even smaller canvas on small screens */
		width: 95%; /* Make sure canvas takes up most of screen width */
	  }
		
	  #showTopsButton, #showBottomsButton, #showOtherButton {
	    font-size: 13px; /* Even smaller text */
		padding: 6px 15px; /* Even less padding */
	  }
	  
	}
  </style>
</head>
<body>
  <div class="container">
    <a href="index.html" style="
      display: inline-block;
      margin: 5px;
      text-decoration: none;
      color: #362200;
      font-size: 0.9rem;
      transition: background-color 0.3s ease;">
      Back to Home
    </a>
    <a href="view-arrangements.html" style="
      display: inline-block;
      margin: 5px;
      text-decoration: none;
      color: #362200;
      font-size: 0.9rem;
      transition: background-color 0.3s ease;">
      view saved outfits
    </a>
    <h1>Clothes Drag-and-Drop Viewer</h1>

    <!-- Buttons for Tops, Bottoms, and Other categories -->
    <button id="showTopsButton">Tops</button>
    <button id="showBottomsButton">Bottoms</button>
    <button id="showOtherButton">Other</button>

    <!-- Subcategory buttons for Tops -->
    <div id="topsButtons" class="hidden">
      <button data-folder="tubeTops">Tube Tops</button>
      <button data-folder="tankTops">Tank Tops</button>
      <button data-folder="teeShirts">Tee Shirts</button>
      <button data-folder="longSleeves">Long Sleeves</button>
      <button id="viewAllTops">All Tops</button>
    </div>

    <!-- Subcategory buttons for Bottoms -->
    <div id="bottomsButtons" class="hidden">
      <button data-folder="jeans">Jeans</button>
      <button data-folder="skirts">Skirts</button>
      <button data-folder="otherPants">Other Pants</button>
      <button data-folder="shorts">Shorts</button>
      <button id="viewAllBottoms">All Bottoms</button>
    </div>

    <!-- Subcategory buttons for Other -->
    <div id="otherButtons" class="hidden">
      <button data-folder="jackets">Jackets</button>
      <button data-folder="shoes">Shoes</button>
    </div>

    <!-- Displaying image thumbnails -->
    <div class="image-gallery" id="imageGallery">
      <!-- Thumbnails will be dynamically inserted here -->
    </div>

    <!-- Drag-and-drop canvas -->
    <div id="canvas">
      <p>clothes go here!</p>
    </div>
  </div>

  <script>
    const imageGallery = document.getElementById('imageGallery');
    const canvas = document.getElementById('canvas');

    // Buttons for Tops, Bottoms, and Other categories
    const showTopsButton = document.getElementById('showTopsButton');
    const showBottomsButton = document.getElementById('showBottomsButton');
    const showOtherButton = document.getElementById('showOtherButton');

    // Subcategory buttons
    const topsButtons = document.getElementById('topsButtons');
    const bottomsButtons = document.getElementById('bottomsButtons');
    const otherButtons = document.getElementById('otherButtons');
    const viewAllTopsButton = document.getElementById('viewAllTops');
    const viewAllBottomsButton = document.getElementById('viewAllBottoms');
    const viewAllOtherButton = document.getElementById('viewAllOther');

    // Folders for each category
    const folders = {
      tops: ['tubeTops', 'tankTops', 'teeShirts', 'longSleeves'],
      bottoms: ['jeans', 'skirts', 'otherPants', 'shorts'],
      other: ['jackets', 'shoes']
    };

    // Function to display the images as thumbnails
    function displayThumbnails(folderNames) {
      imageGallery.innerHTML = ''; // Clear the gallery

      folderNames.forEach(folder => {
        for (let i = 1; i <= 100; i++) {
          const imgElement = document.createElement('img');
          const imgSrc = `images/${folder}/${i}.png`;

          // Create a new image to check if the photo exists
          const img = new Image();
          img.src = imgSrc;

          img.onload = function() {
            // If image is loaded successfully, add it to the gallery
            imgElement.src = imgSrc;
            imgElement.alt = `${folder} ${i}`;
            imgElement.onclick = () => addImageToCanvas(imgSrc);

            imageGallery.appendChild(imgElement);
          };

          img.onerror = function() {
            // If the image can't be loaded, break the loop for this folder
            console.log(`No ${i}.png found in ${folder}. Stopping further attempts.`);
            return;  // Break the loop by returning early
          };
        }
      });
    }

    // Function to add the selected image to the canvas
    function addImageToCanvas(imageSrc) {
      const imgContainer = createPhotoContainer(imageSrc);
      canvas.appendChild(imgContainer);
    }

    // Create photo container with drag functionality
    function createPhotoContainer(photoSrc) {
      const container = document.createElement('div');
      container.classList.add('draggable-container');

      // Set random initial position for the container
      container.style.position = 'absolute';
      container.style.left = `${Math.random() * (canvas.offsetWidth - 150)}px`;
      container.style.top = `${Math.random() * (canvas.offsetHeight - 150)}px`;

      // Create the image
      const img = document.createElement('img');
      img.src = photoSrc;
      img.classList.add('draggable');

      // Disable default drag behavior to avoid copying
      img.setAttribute('draggable', 'false');

      // Add drag-and-drop functionality
        container.addEventListener('mousedown', onDragStart);
        container.addEventListener('touchstart', onDragStart, { passive: false });

      // Double-click to delete photo
      container.addEventListener('dblclick', () => {
        container.remove();
      });

      // Append the image to the container
      container.appendChild(img);

      return container;
    }

    // Drag-and-drop logic
    let draggedElement = null;

    function onDragStart(event) {
        const container = event.currentTarget;
        draggedElement = container;


        let startX, startY;
         if (event.type === 'touchstart') {
            const rect = container.getBoundingClientRect();
            startX = event.touches[0].clientX - rect.left;
            startY = event.touches[0].clientY - rect.top;

        } else {
        const rect = container.getBoundingClientRect();
        startX = event.clientX - rect.left;
        startY = event.clientY - rect.top;
        }

        function onMove(e) {
            const canvasRect = canvas.getBoundingClientRect();
            let x, y;
             if (e.type === 'touchmove') {
               x = e.touches[0].clientX - canvasRect.left - startX;
               y = e.touches[0].clientY - canvasRect.top - startY;
            } else {
                 x = e.clientX - canvasRect.left - startX;
                 y = e.clientY - canvasRect.top - startY;
             }
         x = Math.max(0, Math.min(x, canvas.offsetWidth - container.offsetWidth));
        y = Math.max(0, Math.min(y, canvas.offsetHeight - container.offsetHeight));

            container.style.left = `${x}px`;
            container.style.top = `${y}px`;
        }

         function onEnd(e) {
            document.removeEventListener('mousemove', onMove);
             document.removeEventListener('mouseup', onEnd);
            document.removeEventListener('touchmove', onMove);
            document.removeEventListener('touchend', onEnd);
            document.removeEventListener('touchcancel', onEnd);
         }

        if (event.type === 'touchstart') {
            document.addEventListener('touchmove', onMove, { passive: false });
             document.addEventListener('touchend', onEnd);
             document.addEventListener('touchcancel', onEnd);
        } else {
        document.addEventListener('mousemove', onMove);
             document.addEventListener('mouseup', onEnd);
        }
    }

    // Event listeners for category buttons
    showTopsButton.addEventListener('click', () => {
      topsButtons.classList.toggle('hidden');
      bottomsButtons.classList.add('hidden'); // Hide bottoms buttons if open
      otherButtons.classList.add('hidden'); // Hide other buttons if open
      imageGallery.innerHTML = ''; // Clear gallery when switching
    });

    showBottomsButton.addEventListener('click', () => {
      bottomsButtons.classList.toggle('hidden');
      topsButtons.classList.add('hidden'); // Hide tops buttons if open
      otherButtons.classList.add('hidden'); // Hide other buttons if open
      imageGallery.innerHTML = ''; // Clear gallery when switching
    });

    showOtherButton.addEventListener('click', () => {
      otherButtons.classList.toggle('hidden');
      topsButtons.classList.add('hidden'); // Hide tops buttons if open
      bottomsButtons.classList.add('hidden'); // Hide bottoms buttons if open
      imageGallery.innerHTML = ''; // Clear gallery when switching
    });

    // Event listener for subcategory buttons
    topsButtons.addEventListener('click', (e) => {
      if (e.target.dataset.folder) {
        displayThumbnails([e.target.dataset.folder]);
      }
    });

    bottomsButtons.addEventListener('click', (e) => {
      if (e.target.dataset.folder) {
        displayThumbnails([e.target.dataset.folder]);
      }
    });

    otherButtons.addEventListener('click', (e) => {
      if (e.target.dataset.folder) {
        displayThumbnails([e.target.dataset.folder]);
      }
    });

    // View all tops
    viewAllTopsButton.addEventListener('click', () => {
      displayThumbnails(folders.tops);
    });

    // View all bottoms
    viewAllBottomsButton.addEventListener('click', () => {
      displayThumbnails(folders.bottoms);
    });
    
  const saveDatabaseButton = document.createElement('button');
  saveDatabaseButton.textContent = "Save Outfit";
  saveDatabaseButton.style.margin = "10px";
  document.querySelector('.container').appendChild(saveDatabaseButton);

  const loadDatabaseButton = document.createElement('button');
  loadDatabaseButton.textContent = "Load Outfit";
  loadDatabaseButton.style.margin = "10px";
  document.querySelector('.container').appendChild(loadDatabaseButton);

  const databaseSelect = document.createElement('select');
  databaseSelect.style.margin = "10px";
  document.querySelector('.container').appendChild(databaseSelect);


        saveDatabaseButton.addEventListener('click', async () => {
            const name = prompt("Enter a name for this arrangement:");
                if (!name) return alert("Arrangement name is required!");
        
              // Collect additional metadata
                 const tags = prompt("Enter tags or notes for this arrangement (optional):");
                const timestamp = new Date().toISOString();
        
                // Collect photo data (ensure it's in array format)
               const photos = Array.from(canvas.querySelectorAll('.draggable-container'));
                const arrangement = photos.map(photo => {
                    const img = photo.querySelector('img');
                    return {
                    src: img.src,
                    left: photo.style.left,
                   top: photo.style.top,
                  };
               });
        
            try {
                  await db.collection('outfits').add({ name, arrangement, tags, timestamp });
                   updateDatabaseDropdown();
                   alert(`Arrangement "${name}" saved successfully!`);
                 } catch (error) {
                    console.error('Error saving outfit:', error);
                    alert('Failed to save outfit.');
                }
            });

        // Load arrangement from database
        loadDatabaseButton.addEventListener('click', async () => {
            const selectedArrangement = databaseSelect.value;
            if (!selectedArrangement) return alert("Please select an arrangement to load!");
        
          try {
              const querySnapshot = await db.collection('outfits').get();
              const outfits = querySnapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
                const database = outfits.reduce((acc, curr) => {
                   acc[curr.id] = curr;
                   return acc;
               }, {});
            const entry = database[selectedArrangement];
            // Display metadata (optional)
             console.log(`Loading arrangement: ${selectedArrangement}`);
             console.log(`Tags/Notes: ${entry.tags || "No tags"}`);
              console.log(`Saved on: ${entry.timestamp || "Unknown date"}`);
        
            // Clear the canvas and load the arrangement
              canvas.innerHTML = '<p>clothes go here!</p>';
               entry.arrangement.forEach(item => {
                   const imgContainer = createPhotoContainer(item.src);
                   imgContainer.style.left = item.left;
                  imgContainer.style.top = item.top;
                  canvas.appendChild(imgContainer);
               });
            } catch (error) {
                 console.error("Error fetching saved outfits:", error);
          }
         });
        
          // Populate the dropdown with saved arrangements
          async function updateDatabaseDropdown() {
          try {
               const querySnapshot = await db.collection('outfits').get();
                 const outfits = querySnapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
                    const database = outfits.reduce((acc, curr) => {
                        acc[curr.id] = curr;
                         return acc;
                        }, {});
                 databaseSelect.innerHTML = '<option value="">pick outfit</option>';
                 Object.keys(database).forEach((key) => {
                     const option = document.createElement('option');
                    option.value = key;
                   option.textContent = database[key].name;
                     databaseSelect.appendChild(option);
                   });
           } catch (error) {
                 console.error("Error fetching saved outfits for dropdown:", error);
          }
         }
         updateDatabaseDropdown();
  </script>
</body>
</html>