<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>saved outfits</title>
  <style>
      body {
      font-family: Georgia, serif;
      font-size: 16px;
      letter-spacing: 1.2px;
      background-color: #362200;
      color: #452c00;
      font-weight: 700;
      text-transform: uppercase;
      margin: 0;
      padding: 0;
    }
    a:hover {
	  color: #FFFFFF; /* Change text color to white */
	  transform: scale(1.05); /* Add a slight zoom effect */
	}
	
	a:active {
	  transform: scale(0.95); /* Add a "pressed" effect */
	}
    .container {
	  margin: 0 auto;
	  margin-top: 10px;
      text-align: center;
      background-color: #FFCCCB;
      padding: 10px;
      border-radius: 30px;
      width: 50%;
      
    }
    
    .container2 {
      width: 100%;
      margin-top: 10px; 
      text-align: center;
      padding: 20px;
      background-color: #362200;
      
    }
    h1 {
      color: #362200;
    }
    
    
    .arrangement-list {
      margin-bottom: 0px;
      font-size: 12px;
      display: flex;            /* Use flexbox to arrange items side by side */
      flex-wrap: wrap;          /* Allow items to wrap onto a new line if needed */
      justify-content: center;  /* Align items centrally */
    }
    .arrangement {
      margin: 10px;
      width: 300px;
      padding: 5px;
      color: #FFF;
      border-radius: 10px;
      background-color: #FFCCCB;
      display: inline-block;    /* Ensures arrangements are inline */
    }
    .canvas {
      position: relative;
      width: 300px;
      height: 300px;
      margin: 0 auto;
      border: 1px solid #452c00;
      border-radius: 10px;
      overflow: auto;
      background-color: #FFFFFF;
    }
    .draggable {
      position: absolute;
      max-width: 100px;
      max-height: 100px;
    }

    .delete-button {
      position: relative;
      bottom: 35px;
      right: 20%;
      background-color: transparent;
      color: white;
      border: none;
      padding: 3px 8px;
      font-size: 10px;
      border-radius: 3px;
      cursor: pointer;
      text-transform: uppercase;
      font-weight: bold;
    }

    .delete-button:hover {
      background-color: #CC0000;
    }
    .save-json-button {
      position: relative;
      bottom: 10px;
      left: 20%;
      down: 10%;
      background-color: transparent;
      color: white;
      border: none;
      padding: 3px 8px;
      font-size: 10px;
      border-radius: 3px;
      cursor: pointer;
      text-transform: uppercase;
      font-weight: bold;
    }

.save-json-button:hover {
  background-color: pink; /* Green color for hover effect */
}

  </style>
</head>
<body>
  <div class="container">
    <a href="index.html" style="
      display: inline-block;
      margin: 15px;
      text-decoration: none;
      color: #362200;
      font-size: 1rem;
      transition: background-color 0.3s ease;">
      Back to Home
    </a>
    <h1>Saved outfits</h1>
    </div>
    <div class="container2">
    <div class="arrangement-list" id="arrangementList"></div>
    
  </div>


<!-- 
<script>
function saveArrangementToJSONBin(name, arrangement) {
  const BIN_ID = localStorage.getItem("jsonBinId");
  const JSONBIN_ENDPOINT = BIN_ID
    ? `https://api.jsonbin.io/v3/b/679e2be3ad19ca34f8f80cdd`
    : "https://api.jsonbin.io/v3/b";

  fetch(JSONBIN_ENDPOINT, {
    method: 'GET',
    headers: {
      "X-Master-Key": "$2a$10$4IjfK0Y5ynpvKoctDkiCuuoFy236u9kzNg.bMlMoXxEPk.YUtddrq"
    }
  })
.then(response => response.json())
.then(data => {
    console.log("Full API Response:", data); // Debugging: Check API response structure

    if (!data || !data.record) {
        throw new Error("Invalid data format received from JSONBin.");
    }

    const savedArrangements = data.record;  // The actual saved object
    console.log("Extracted Saved Arrangements:", savedArrangements); // Debugging

    const arrangementList = document.getElementById('arrangementList');
    arrangementList.innerHTML = ""; // Clear previous content

    Object.keys(savedArrangements).forEach(key => {
        const arrangement = savedArrangements[key];

        if (!Array.isArray(arrangement.arrangement)) {
            console.warn(`Skipping invalid arrangement format for ${key}`, arrangement);
            return;
        }

        const arrangementDiv = document.createElement('div');
        arrangementDiv.classList.add('arrangement');

        const title = document.createElement('h3');
        title.textContent = key;
        arrangementDiv.appendChild(title);

        // Create a canvas for images
        const canvas = document.createElement('div');
        canvas.classList.add('canvas');

        arrangement.arrangement.forEach(photo => {
            const img = document.createElement('img');
            img.src = photo.src;
            img.style.left = photo.left;
            img.style.top = photo.top;
            img.classList.add('draggable');
            canvas.appendChild(img);
        });

        arrangementDiv.appendChild(canvas);
        arrangementList.appendChild(arrangementDiv);
    });
})
.catch(error => {
    console.error("Error fetching saved arrangements:", error);
    document.getElementById('arrangementList').innerHTML = "<p>Error loading saved arrangements. Please try again.</p>";
});
</script>
 -->
<script>
function saveArrangementToJSONBin(name, arrangement) {
  const BIN_ID = localStorage.getItem("jsonBinId");
  const JSONBIN_ENDPOINT = BIN_ID
    ? `https://api.jsonbin.io/v3/b/679e2be3ad19ca34f8f80cdd`
    : "https://api.jsonbin.io/v3/b";

  // First, fetch the existing data from JSONBin
  fetch(JSONBIN_ENDPOINT, {
    method: 'GET',
    headers: {
      "X-Master-Key": "$2a$10$4IjfK0Y5ynpvKoctDkiCuuoFy236u9kzNg.bMlMoXxEPk.YUtddrq"
    }
  })
  .then(response => response.json())
  .then(data => {
      let updatedData = data.record || {}; // Make sure we are handling the right structure

      // Add/update the new arrangement
      updatedData[name] = arrangement;

      // Save the updated data back to JSONBin
      return fetch(JSONBIN_ENDPOINT, {
        method: 'PUT', // Use PUT to update
        headers: {
          "Content-Type": "application/json",
          "X-Master-Key": "$2a$10$4IjfK0Y5ynpvKoctDkiCuuoFy236u9kzNg.bMlMoXxEPk.YUtddrq"
        },
        body: JSON.stringify(updatedData)
      });
  })
  .then(response => response.json())
  .then(data => {
      console.log("Successfully saved to JSONBin:", data);
      alert("Arrangement saved successfully!");
  })
  .catch(error => {
      console.error("Error saving to JSONBin:", error);
      alert("Failed to save. Check the console for errors.");
  });
}
function fetchSavedArrangements() {
  const BIN_ID = localStorage.getItem("jsonBinId");
  if (!BIN_ID) {
    console.warn("No JSONBin ID found. Nothing to fetch.");
    return;
  }

  const JSONBIN_ENDPOINT = `https://api.jsonbin.io/v3/b/679e2be3ad19ca34f8f80cdd`;

  fetch(JSONBIN_ENDPOINT, {
    method: 'GET',
    headers: {
      "X-Master-Key": "$2a$10$4IjfK0Y5ynpvKoctDkiCuuoFy236u9kzNg.bMlMoXxEPk.YUtddrq"
    }
  })
  .then(response => response.json())
  .then(data => {
      console.log("Full API Response:", data); // Debugging: Log the entire response

      if (!data || typeof data !== 'object' || !data.record) {
          throw new Error("Invalid data format received from JSONBin.");
      }

      let savedArrangements = data.record;

      // âŒ Exclude "record" and "metadata" keys
      Object.keys(savedArrangements).forEach(key => {
          if (key === "record" || key === "metadata") {
              delete savedArrangements[key];
          }
      });

      console.log("Filtered Saved Arrangements:", savedArrangements); // Debugging

      const arrangementList = document.getElementById('arrangementList');
      arrangementList.innerHTML = ""; // Clear previous content

      Object.keys(savedArrangements).forEach(key => {
          const arrangement = savedArrangements[key];

          if (!arrangement || !Array.isArray(arrangement.arrangement)) {
              console.warn(`Skipping invalid arrangement format for ${key}`, arrangement);
              return;
          }

          const arrangementDiv = document.createElement('div');
          arrangementDiv.classList.add('arrangement');

          const title = document.createElement('h3');
          title.textContent = key;
          arrangementDiv.appendChild(title);

          // Create a canvas for images
          const canvas = document.createElement('div');
          canvas.classList.add('canvas');

          arrangement.arrangement.forEach(photo => {
              const img = document.createElement('img');
              img.src = photo.src;
              img.style.left = photo.left;
              img.style.top = photo.top;
              img.classList.add('draggable');
              canvas.appendChild(img);
          });

          arrangementDiv.appendChild(canvas);
          arrangementList.appendChild(arrangementDiv);
      });
  })
  .catch(error => {
      console.error("Error fetching saved arrangements:", error);
      document.getElementById('arrangementList').innerHTML = "<p>Error loading saved arrangements. Please try again.</p>";
  });
}


document.addEventListener("DOMContentLoaded", fetchSavedArrangements);

</script>
</body>
</html>
